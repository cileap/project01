# NPU 虚拟校园地图 - 交互系统

基于 Qt6 和 C++ 开发的西北工业大学长安校区虚拟地图交互应用。

## 项目简介

本项目实现了一个可交互的校园地图系统，用户可以在地图上添加标记点、备注信息，并支持时间回溯功能查看历史标记状态。类似于 Git 的版本控制，可以回溯到任意时间点查看当时的标记情况。

## 主要功能

### 已实现功能

- **地图显示与交互**
  - 鼠标拖拽平移地图
  - 鼠标滚轮缩放地图
  - 地图图片加载（可自定义校园地图图片）

- **标记管理**
  - 在地图任意位置添加标记点
  - 为标记添加备注信息
  - 自定义标记颜色
  - 右键点击标记查看备注
  - 管理员权限删除标记（防止恶意标记）

- **时间回溯**
  - 自动记录每次标记变更
  - 通过时间轴滑块回溯到任意历史时间点
  - 查看任意时刻的标记完整状态（包括备注、颜色等）
  - 一键返回最新状态

- **数据同步**
  - 与后端服务器同步标记数据
  - 支持 RESTful API 通信
  - 网络错误处理

## 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Qt | 6.x | GUI 框架 |
| C++ | C++17 | 开发语言 |
| CMake | 3.16+ | 构建系统 |
| JSON | - | 数据序列化 |

## 项目结构

```
project01/
├── CMakeLists.txt              # CMake 构建配置
├── main.cpp                    # 程序入口
├── mainwindow.h / .cpp         # 主窗口
│
├── src/data/                   # 数据结构
│   ├── marker.h / .cpp         # 标记数据
│   └── mapsnapshot.h / .cpp    # 历史快照数据
│
├── src/widgets/                # UI 组件
│   ├── mapview.h / .cpp        # 地图显示组件
│   └── timelinewidget.h / .cpp # 时间轴组件
│
├── src/core/                   # 核心业务逻辑
│   └── markermanager.h / .cpp  # 标记和快照管理器
│
└── src/network/                # 网络通信
    └── apiclient.h / .cpp      # API 客户端
```

## 编译运行

### 环境要求

- Qt 6.x
- CMake 3.16+
- C++17 编译器（MSVC/GCC/Clang）

### 编译步骤

```bash
# 配置 CMake
cmake -B build

# 编译
cmake --build build

# 运行
.\build\bin\LibraryMap.exe
```

或使用提供的脚本：
```powershell
.\script\build.ps1
```

## 使用说明

### 添加标记
1. 点击左侧"添加标记"按钮，或直接点击地图
2. 在弹出的对话框中输入备注信息
3. 选择标记颜色
4. 标记将显示在地图上

### 删除标记（管理员权限）
1. 右键点击要删除的标记
2. 选择"删除标记"
3. 确认删除操作

### 时间回溯
1. 使用底部时间轴滑块
2. 拖动滑块到想要查看的时间点
3. 地图将显示该时刻的标记状态
4. 点击"返回最新状态"恢复到当前

### 地图操作
- **平移**：鼠标左键拖拽
- **缩放**：鼠标滚轮

## API 接口说明

本项目通过 RESTful API 与后端通信：

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/map/snapshots` | GET | 获取所有历史快照 |
| `/api/map/markers` | POST | 创建新标记 |
| `/api/map/markers/{id}` | DELETE | 删除指定标记 |

默认后端地址：`http://localhost:8080/api`

## 开发者

- **前端（Qt/C++）**：负责客户端应用开发
- **后端**：合作者负责服务器端 API 开发和数据存储

## 许可证

本项目仅用于学习和研究目的。

## 更新日志

### v1.0.0 (当前版本)
- 实现基础地图显示和交互
- 实现标记添加和删除功能
- 实现时间回溯功能
- 实现网络 API 通信
